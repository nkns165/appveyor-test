#image:
#  - Visual Studio 2017
#  - Visual Studio 2019

environment:
  FIXED_VAR: "Fixed value"
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      DEFAULT_VAR1: "Value1"
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      DEFAULT_VAR1: "Value2"
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      DEFAULT_VAR1: "Value1"


init:
  ps : >-
    echo "DEFAULT_VAR1 = $env:DEFAULT_VAR1";
    echo "VAR1 = $env:VAR1";
    echo (Test-Path env:VAR1);
    if (!(Test-Path env:VAR1)) { echo "Not exist" } else { echo "Exist"}
    if (!(Test-Path env:VAR1)) { $env:VAR1 = $env:DEFAULT_VAR1 }
    echo "merged VAR1 = $env:VAR1";

build_script:
  ps: echo "Skip this settings"

for:
-
  matrix:
    only:
      - image: Visual Studio 2017

  build_script:
    - ps: echo "VAR1 = $env:VAR1"

-
  matrix:
    only:
      - image: Visual Studio 2019

  build_script:
    - ps: echo "VAR1 = $env:VAR1"

